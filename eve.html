<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>EPL Draft Duel ‚Äî ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á (FPL ‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #070b16;
        --panel: #0d1324;
        --soft: #111a2f;
        --ring: #223047;
        --muted: #a9b3c3;
        --pri: #22d3ee;
        --pri2: #818cf8;
        --ok: #34d399;
        --warn: #f59e0b;
        --bad: #ef4444;
        --text: #e7edf6;
      }
      /* ===================== Responsive overrides ===================== */

      @media (max-width: 1200px) {
        .grid-3 {
          grid-template-columns: 1fr;
        }
        .sticky-head {
          top: 58px;
        }
      }

      @media (max-width: 992px) {
        .logo-picker {
          grid-template-columns: repeat(4, 1fr);
        }
        .players-grid {
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        }
        /* ‚úÖ ‡∏Ñ‡∏á 12 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÑ‡∏ß‡πâ ‡πÅ‡∏•‡∏∞‡∏¢‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÅ‡∏ñ‡∏ß‡∏•‡∏á */
        .formation {
          grid-template-columns: repeat(12, 1fr);
          grid-auto-rows: 76px;
        }
        .row2 {
          grid-template-columns: 1fr;
        }
        .row2 > div:nth-child(2) {
          order: 3;
          margin: 8px 0;
        }
      }

      @media (max-width: 768px) {
        header .container {
          padding: 10px 12px;
        }
        .container {
          padding: 12px;
        }
        h1 {
          font-size: 18px;
        }
        .logo-pick img {
          width: 32px;
          height: 32px;
        }
        .avatar {
          width: 40px;
          height: 40px;
        }
        button {
          width: 100%;
          padding: 10px 12px;
        }
        .seg {
          width: 100%;
        }
        .seg button {
          flex: 1;
        }
        .chip,
        .badge {
          padding: 4px 8px;
        }
        .players-grid {
          grid-template-columns: 1fr 1fr;
        }
        /* ‚úÖ ‡∏Ñ‡∏á 12 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÑ‡∏ß‡πâ ‡πÅ‡∏•‡∏∞‡∏¢‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÅ‡∏ñ‡∏ß‡∏•‡∏á‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î */
        .formation {
          grid-template-columns: repeat(12, 1fr);
          grid-auto-rows: 64px;
        }
      }

      @media (max-width: 560px) {
        .logo-picker {
          grid-template-columns: repeat(3, 1fr);
        }
        .players-grid {
          grid-template-columns: 1fr;
        }
        .summary-card {
          padding: 12px;
        }
        .p-card {
          padding: 8px;
        }
      }
      @media (hover: none) and (pointer: coarse) {
        .sticky-head {
          position: static;
        }
        #teamsPlayers {
          max-height: none;
        }
      }

      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        color: var(--text);
        font-family: "Kanit", system-ui, Roboto;
        background: radial-gradient(
            1100px 800px at 10% -10%,
            #1b2440 0%,
            #0f1733 45%,
            #070b16 100%
          )
          fixed;
        min-height: 100svh;
      }
      header {
        position: sticky;
        top: 0;
        z-index: 10;
        border-bottom: 1px solid var(--ring);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.06),
          rgba(255, 255, 255, 0)
        );
        backdrop-filter: blur(8px);
      }
      .container {
        max-width: 1320px;
        margin: 0 auto;
        padding: 14px 16px;
      }
      h1 {
        margin: 0;
        font-size: 20px;
      }
      .grid {
        display: grid;
        gap: 14px;
      }
      .grid-3 {
        grid-template-columns: 300px 1fr 380px;
      }
      @media (max-width: 1200px) {
        .grid-3 {
          grid-template-columns: 1fr;
        }
      }

      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.04),
          rgba(255, 255, 255, 0.015)
        );
        border: 1px solid var(--ring);
        border-radius: 16px;
        padding: 12px;
      }
      .small {
        font-size: 12px;
        color: var(--muted);
      }
      button {
        cursor: pointer;
        border: 1px solid #0ea5e9;
        background: linear-gradient(180deg, #1d4ed8, #0ea5e9);
        font-weight: 800;
        border-radius: 12px;
        padding: 10px 14px;
        color: #fff;
      }
      button.ghost {
        background: var(--panel);
        border: 1px solid #334155;
      }
      button.ghost.sel {
        outline: 2px solid var(--pri);
      }

      .chip {
        display: inline-flex;
        gap: 6px;
        align-items: center;
        background: var(--panel);
        border: 1px solid #2a3650;
        border-radius: 999px;
        padding: 6px 10px;
      }
      .badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: #0b1220;
        border: 1px solid #344155;
        border-radius: 10px;
        padding: 4px 8px;
      }

      .logo-picker {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 8px;
      }
      .logo-pick {
        border: 1px solid #2a3650;
        border-radius: 12px;
        padding: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #0b1220;
        cursor: pointer;
        transition: transform 0.08s;
      }
      .logo-pick:hover {
        transform: translateY(-2px);
      }
      .logo-pick img {
        width: 38px;
        height: 38px;
      }

      .crest {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 1px solid #2a3650;
        overflow: hidden;
      }
      .crest img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .team-section {
        border: 1px solid #2a3650;
        border-radius: 14px;
        padding: 10px;
        background: #0b1220;
      }
      .players-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 10px;
      }

      .p-card {
        border: 1px solid #223047;
        border-radius: 14px;
        padding: 10px;
        background: #0a1120;
      }
      .p-head {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .avatar {
        width: 46px;
        height: 46px;
        border-radius: 50%;
        border: 1px solid #334155;
        overflow: hidden;
      }
      .avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .bars {
        display: grid;
        gap: 6px;
        margin-top: 6px;
      }
      .bar {
        height: 8px;
        background: #0f172a;
        border: 1px solid #263149;
        border-radius: 999px;
        overflow: hidden;
      }
      .bar > span {
        display: block;
        height: 100%;
        background: linear-gradient(90deg, var(--pri), var(--pri2));
      }

      /* ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏à‡∏±‡∏î‡∏ó‡∏µ‡∏°‡πÅ‡∏ö‡∏ö ‚Äú‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏≠‡∏•‚Äù + 4-3-3 */
      .formation {
        position: relative;
        display: grid;
        grid-template-columns: repeat(12, 1fr); /* 12 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö mapping */
        grid-auto-rows: 86px; /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ñ‡∏ß‡∏Ç‡∏≠‡∏á‡∏™‡∏ô‡∏≤‡∏° */
        gap: 10px;
        padding: 10px;
        border-radius: 14px;
        background: repeating-linear-gradient(
          0deg,
          #0e5a2a 0 24px,
          #0f612d 24px 48px
        );
        border: 1px solid #224a33;
        box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.06);
      }
      /* ‡πÄ‡∏™‡πâ‡∏ô‡∏™‡∏ô‡∏≤‡∏° */
      .formation::before {
        content: "";
        position: absolute;
        inset: 8px;
        border: 2px solid rgba(255, 255, 255, 0.18);
        border-radius: 12px;
        pointer-events: none;
      }
      .formation::after {
        content: "";
        position: absolute;
        left: 50%;
        top: 8px;
        bottom: 8px;
        width: 2px;
        background: rgba(255, 255, 255, 0.18);
        transform: translateX(-50%);
        pointer-events: none;
      }

      .slot {
        min-height: 92px;
        border: 1px dashed #2b3650;
        border-radius: 12px;
        padding: 8px;
        background: #0b1220;
      }
      .slot.fill {
        border: 1px solid #2dd4bf;
      }
      .slot.wrong {
        box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.25);
      }

      .sum {
        font-weight: 800;
        font-size: 22px;
      }
      .mask {
        filter: blur(6px);
        opacity: 0.7;
        user-select: none;
      }

      .sticky-head {
        position: sticky;
        top: 68px;
        z-index: 5;
        background: linear-gradient(
          180deg,
          rgba(13, 19, 36, 0.95),
          rgba(13, 19, 36, 0.8)
        );
        border: 1px solid #23324b;
        border-radius: 12px;
        padding: 8px;
        margin-bottom: 10px;
        backdrop-filter: blur(4px);
      }
      .seg {
        display: inline-flex;
        background: #0e162b;
        border: 1px solid #2a395b;
        border-radius: 10px;
        overflow: hidden;
      }
      .seg button {
        border: none;
        background: transparent;
        padding: 8px 12px;
      }
      .seg button.active {
        background: #163056;
      }

      #summaryView {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.75);
        backdrop-filter: blur(4px);
        display: none;
        align-items: center;
        justify-content: center;
        padding: 16px;
      }
      .summary-card {
        max-width: 1100px;
        width: 100%;
        background: #0b1220;
        border: 1px solid #2a3650;
        border-radius: 16px;
        padding: 16px;
      }

      .row2 {
        display: grid;
        grid-template-columns: 1fr 220px 1fr;
        gap: 10px;
        align-items: center;
      }
      .diffbar {
        height: 8px;
        background: #0f172a;
        border: 1px solid #263149;
        border-radius: 999px;
        overflow: hidden;
      }
      .diffA {
        height: 100%;
        float: right;
        background: linear-gradient(90deg, #34d399, #22c55e);
      }
      .diffB {
        height: 100%;
        background: linear-gradient(90deg, #ef4444, #f97316);
      }

      .footer-hint {
        position: sticky;
        bottom: 0;
        margin-top: 10px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(255, 255, 255, 0.006)
        );
        border: 1px dashed #30415f;
        border-radius: 12px;
        padding: 8px;
      }
      .err {
        color: #fecaca;
      }
    </style>
  </head>
  <body>
    <header>
      <div
        class="container"
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 10px;
          flex-wrap: wrap;
        "
      >
        <h1>‚öΩ EPL Draft Duel ‚Äî ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á (FPL ‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)</h1>
        <div
          style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap"
        >
          <span class="chip"
            >GW ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <b id="labGW" style="margin-left: 6px">‚Äî</b></span
          >
          <span class="chip"
            >‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: <span id="labUpd" style="margin-left: 6px">‚Äî</span></span
          >
          <span class="badge"
            >A ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏µ‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏´‡∏•‡∏∑‡∏≠ <b id="quotaA">3</b></span
          >
          <span class="badge"
            >B ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏µ‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏´‡∏•‡∏∑‡∏≠ <b id="quotaB">3</b></span
          >
          <button id="btnReload" class="ghost">‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
      </div>
    </header>

    <main class="container grid grid-3" id="mainView">
      <!-- ‡∏ã‡πâ‡∏≤‡∏¢: ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÇ‡∏ä‡∏ß‡πå + ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ù‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏ï‡∏£‡∏≤ -->
      <section class="card">
        <h3 style="margin: 0 0 6px">‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏£‡πå‡∏•‡∏µ‡∏Å (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏ä‡∏ß‡πå‡∏ö‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô)</h3>
        <div class="small">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ù‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏ï‡∏£‡∏≤ ‚Üí ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</div>
        <div style="display: flex; gap: 8px; margin: 8px 0">
          <button id="btnCrestA" class="ghost sel" onclick="setCrestSide('A')">
            ‡∏ï‡∏±‡πâ‡∏á‡∏ï‡∏£‡∏≤‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏° A
          </button>
          <button id="btnCrestB" class="ghost" onclick="setCrestSide('B')">
            ‡∏ï‡∏±‡πâ‡∏á‡∏ï‡∏£‡∏≤‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏° B
          </button>
        </div>
        <div id="logoGrid" class="logo-picker" style="margin-top: 8px"></div>
        <div class="footer-hint small">
          <div>‡∏ï‡∏£‡∏≤‡πÇ‡∏ä‡∏ß‡πå ‚â† ‡∏ó‡∏µ‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)</div>
          <div
            style="
              display: flex;
              gap: 8px;
              align-items: center;
              margin-top: 6px;
            "
          >
            <span>‡∏ï‡∏£‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</span>
            <span class="crest" id="crestA" title="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ó‡∏µ‡∏° A"></span
            ><span class="small">‡∏ó‡∏µ‡∏° A</span>
            <span
              class="crest"
              id="crestB"
              title="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ó‡∏µ‡∏° B"
              style="margin-left: 10px"
            ></span
            ><span class="small">‡∏ó‡∏µ‡∏° B</span>
          </div>
        </div>
      </section>

      <!-- ‡∏Å‡∏•‡∏≤‡∏á: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• + XI ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î -->
      <section class="card">
        <div class="sticky-head">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              gap: 8px;
              flex-wrap: wrap;
            "
          >
            <div style="display: flex; align-items: center; gap: 8px">
              <b>‡∏ó‡∏µ‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å GW ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</b>
              <span class="small">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ó‡∏µ‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á XI ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏™‡∏ô‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á</span>
            </div>
            <div
              class="seg"
              role="tablist"
              aria-label="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ù‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏ï‡∏∞"
            >
              <button id="segA" class="active" onclick="setActiveDataSide('A')">
                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏° A
              </button>
              <button id="segB" onclick="setActiveDataSide('B')">
                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏° B
              </button>
            </div>
          </div>
          <div id="dataLogos" class="logo-picker" style="margin-top: 8px"></div>
        </div>

        <div
          id="teamsPlayers"
          style="
            display: grid;
            gap: 12px;
            max-height: 60vh;
            overflow: auto;
            margin-top: 8px;
          "
        ></div>
        <div class="small" id="progress" style="margin-top: 6px">
          ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Ä¶
        </div>
      </section>

      <!-- ‡∏Ç‡∏ß‡∏≤: ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏ó‡∏µ‡∏° A/B -->
      <section class="card">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <b>‡∏ó‡∏µ‡∏° A</b
          ><span
            >‡∏£‡∏ß‡∏°‡∏û‡∏•‡∏±‡∏á: <span id="sumA" class="sum mask">‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà</span></span
          >
        </div>
        <div class="formation" id="formA"></div>
        <div
          style="
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 6px;
          "
        >
          <button
            class="ghost"
            id="btnConfirmA"
            disabled
            onclick="confirmTeam('A')"
          >
            ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ó‡∏µ‡∏° A
          </button>
        </div>

        <hr style="border-color: #2a3650; opacity: 0.4; margin: 10px 0" />

        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <b>‡∏ó‡∏µ‡∏° B</b
          ><span
            >‡∏£‡∏ß‡∏°‡∏û‡∏•‡∏±‡∏á: <span id="sumB" class="sum mask">‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà</span></span
          >
        </div>
        <div class="formation" id="formB"></div>
        <div
          style="
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 6px;
          "
        >
          <button
            class="ghost"
            id="btnConfirmB"
            disabled
            onclick="confirmTeam('B')"
          >
            ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ó‡∏µ‡∏° B
          </button>
        </div>

        <div
          style="
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 12px;
          "
        >
          <button id="btnBattle" disabled onclick="battle()">‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</button>
          <button class="ghost" onclick="resetBoards()">‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô</button>
        </div>
        <div id="result" class="small" style="margin-top: 8px"></div>
      </section>
    </main>

    <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô -->
    <section id="summaryView">
      <div class="summary-card">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
          "
        >
          <h3 style="margin: 0">
            ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô (GW <span id="sumGW">‚Äî</span>)
          </h3>
          <div class="small">‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏ó‡∏µ‡∏°</div>
        </div>

        <!-- ‡πÅ‡∏ñ‡∏ß‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏£‡∏ß‡∏°: ‡∏ï‡∏±‡∏î '‡∏ï‡∏£‡∏≤‡∏™‡πÇ‡∏°‡∏™‡∏£' ‡∏≠‡∏≠‡∏Å ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà' -->
        <div
          style="display: flex; gap: 12px; align-items: center; margin: 8px 0"
        >
          <b id="sumNameA">‡∏ó‡∏µ‡∏° A</b>
          <span class="badge">‡∏£‡∏ß‡∏°: <b id="sumTotalA">0</b></span>
          <span style="margin: 0 8px">VS</span>
          <span class="badge">‡∏£‡∏ß‡∏°: <b id="sumTotalB">0</b></span>
          <b id="sumNameB">‡∏ó‡∏µ‡∏° B</b>
          <div style="margin-left: auto; display: flex; gap: 8px">
            <button onclick="startNewGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà</button>
            <button class="ghost" onclick="closeSummary()">‡∏õ‡∏¥‡∏î</button>
          </div>
        </div>

        <div
          id="sumRows"
          style="display: grid; gap: 6px; margin-top: 8px"
        ></div>
      </div>
    </section>

    <div
      id="status"
      class="small"
      style="position: fixed; right: 12px; bottom: 12px; display: none"
    ></div>

    <script>
      // ...
      // --- ‡∏û‡∏≤‡∏ò‡πÑ‡∏ü‡∏•‡πå (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á GitHub Pages ‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô‡πÇ‡∏•‡∏Ñ‡∏±‡∏•) ---
      const BASE = location.hostname.endsWith("github.io")
        ? location.pathname.replace(/\/[^\/]*$/, "")
        : ".";

      const SNAPSHOT_PATH = `${BASE}/public/data/fpl_current.json`;

      /* ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÅ‡∏ô‡πà‡πÜ 11 ‡∏ä‡πà‡∏≠‡∏á */
      const FORMATION = [
        { id: "GK", expect: "Goalkeeper" },
        { id: "RB", expect: "Defender" },
        { id: "RCB", expect: "Defender" },
        { id: "LCB", expect: "Defender" },
        { id: "LB", expect: "Defender" },
        { id: "CM1", expect: "Midfielder" },
        { id: "CM2", expect: "Midfielder" },
        { id: "CAM", expect: "Midfielder" },
        { id: "RW", expect: "Attacker" },
        { id: "ST", expect: "Attacker" },
        { id: "LW", expect: "Attacker" },
      ];

      /* mapping ‡∏ß‡∏≤‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á 4-3-3 ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏¥‡∏î 12 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
      const LAYOUT_433 = {
        GK: { c: 6, r: 6, span: 2 },
        LB: { c: 3, r: 5, span: 2 },
        LCB: { c: 5, r: 5, span: 2 },
        RCB: { c: 7, r: 5, span: 2 },
        RB: { c: 9, r: 5, span: 2 },
        CM1: { c: 4, r: 4, span: 2 },
        CAM: { c: 6, r: 4, span: 2 },
        CM2: { c: 8, r: 4, span: 2 },
        LW: { c: 3, r: 2, span: 2 },
        ST: { c: 6, r: 2, span: 2 },
        RW: { c: 9, r: 2, span: 2 },
      };

      const WRONG_POS_PENALTY = 0.7;
      const DATA_SWITCH_LIMIT = 3;

      const state = {
        fpl: {
          teams: [],
          playersPlayed: [],
          playersById: {},
          xiByTeam: {},
          gw: null,
          updatedAt: null,
        },
        crestSide: "A",
        dataPickSide: "A",
        dataTeamOf: { A: null, B: null },
        dataSwitchQuota: { A: DATA_SWITCH_LIMIT, B: DATA_SWITCH_LIMIT },
        currentXI: [],
        A: FORMATION.map((x) => ({ ...x, player: null })),
        B: FORMATION.map((x) => ({ ...x, player: null })),
        confirmed: { A: false, B: false },
        crestImg: { A: "", B: "" },
      };

      const statusEl = document.getElementById("status");
      const showStatus = (msg, ms = 2200) => {
        statusEl.style.display = "block";
        statusEl.textContent = msg || "";
        if (ms) setTimeout(() => (statusEl.style.display = "none"), ms);
      };
      const clamp = (v, min = 0, max = 100) =>
        Math.max(min, Math.min(max, +v || 0));

      async function loadSnapshot() {
        try {
          const r = await fetch(SNAPSHOT_PATH + `?t=${Date.now()}`, {
            cache: "no-store",
          });
          if (!r.ok) throw new Error(`HTTP ${r.status}`);

          const ct = (r.headers.get("content-type") || "").toLowerCase();
          if (!ct.includes("application/json")) {
            const sample = await r.text();
            throw new Error(
              "‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà JSON (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á): " + sample.slice(0, 120)
            );
          }
          const j = await r.json();

          const playersById = {};
          (j.players_played || []).forEach((p) => (playersById[p.id] = p));

          state.fpl.teams = j.teams || [];
          state.fpl.playersPlayed = j.players_played || [];
          state.fpl.playersById = playersById;
          state.fpl.xiByTeam = j.xiByTeam || {};
          state.fpl.gw = j.gw || "-";
          state.fpl.updatedAt = j.generated_at || "-";

          document.getElementById("labGW").textContent = state.fpl.gw;
          document.getElementById("labUpd").textContent = state.fpl.updatedAt
            ? new Date(state.fpl.updatedAt).toLocaleString("th-TH", {
                hour12: false,
              })
            : "‚Äî";

          renderLogoGrids();
          document.getElementById("progress").innerHTML =
            '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ó‡∏µ‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π 11 ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î <span class="small">(‡∏´‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤ ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡πÑ‡∏ü‡∏•‡πå <code>public/data/fpl_current.json</code>)</span>';
        } catch (e) {
          document.getElementById("progress").innerHTML =
            '<span class="err">‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:</span> ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå data ‚Äî ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö <b>Actions</b> ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏±‡∏ô workflow ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå';
          console.error(e);
          alert("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:\n" + e.message);
        }
      }

      function renderLogoGrids() {
        const logos = state.fpl.teams.map((t) => ({
          id: t.id,
          name: t.name,
          png: t.badge || t.logo || "",
        }));

        const left = document.getElementById("logoGrid");
        left.innerHTML = "";
        logos.forEach((t) => {
          const d = document.createElement("div");
          d.className = "logo-pick";
          d.title = t.name;
          d.innerHTML = `<img src="${t.png}" alt="${t.name}">`;
          d.onclick = () => {
            const s = state.crestSide;
            document.getElementById(
              s === "A" ? "crestA" : "crestB"
            ).innerHTML = `<img src="${t.png}" alt="${t.name}">`;
            state.crestImg[s] = t.png;
          };
          left.appendChild(d);
        });

        const right = document.getElementById("dataLogos");
        right.innerHTML = "";
        logos.forEach((t) => {
          const d = document.createElement("div");
          d.className = "logo-pick";
          d.title = "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: " + t.name;
          d.innerHTML = `<img src="${t.png}" alt="${t.name}">`;
          d.onclick = () => selectDataTeam(state.dataPickSide, t.id);
          right.appendChild(d);
        });
      }

      function setCrestSide(side) {
        state.crestSide = side;
        document
          .getElementById("btnCrestA")
          .classList.toggle("sel", side === "A");
        document
          .getElementById("btnCrestB")
          .classList.toggle("sel", side === "B");
        showStatus(`‡∏ï‡∏±‡πâ‡∏á‡∏ï‡∏£‡∏≤‡πÇ‡∏ä‡∏ß‡πå‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏° ${side} ‚Äî ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢`);
      }
      function setActiveDataSide(side) {
        state.dataPickSide = side;
        document
          .getElementById("segA")
          .classList.toggle("active", side === "A");
        document
          .getElementById("segB")
          .classList.toggle("active", side === "B");
        showStatus(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ù‡∏±‡πà‡∏á ${side}`);
      }

      function selectDataTeam(side, teamId) {
        if (state.dataTeamOf[side] !== teamId) {
          if (state.dataSwitchQuota[side] <= 0) {
            showStatus(`‡∏ó‡∏µ‡∏° ${side} ‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏µ‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß`, 2500);
            return;
          }
          state.dataSwitchQuota[side]--;
          state.dataTeamOf[side] = teamId;
          document.getElementById("quotaA").textContent =
            state.dataSwitchQuota.A;
          document.getElementById("quotaB").textContent =
            state.dataSwitchQuota.B;
        }
        renderXI(teamId);
      }

      function renderXI(teamId) {
        const ids = state.fpl.xiByTeam[teamId] || [];
        const players = ids
          .map((id) => state.fpl.playersById[id])
          .filter(Boolean);
        state.currentXI = players;

        const teamObj = state.fpl.teams.find((t) => t.id === teamId) || {};
        const teamName = teamObj.name || "‚Äî";

        const box = document.getElementById("teamsPlayers");
        box.innerHTML = "";
        const sec = document.createElement("div");
        sec.className = "team-section";
        sec.innerHTML = `
          <div class="team-header" style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
            <div class="crest"><img src="${teamObj.badge || ""}"></div>
            <b>${teamName}</b>
            <span class="small" style="margin-left:auto">11 ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏™‡∏ô‡∏≤‡∏° (GW ${
              state.fpl.gw
            })</span>
          </div>
          <div class="players-grid"></div>`;
        const grid = sec.querySelector(".players-grid");

        players.forEach((p) => {
          const P = p.powers_gw || {
            ATT: 0,
            CRE: 0,
            DEF: 0,
            FIT: 0,
            CTRL: 0,
            TOTAL: 0,
          };
          const bar = (label, val) =>
            `<div><div class="small" style="display:flex;justify-content:space-between"><span>${label}</span><span>${Math.round(
              val
            )}</span></div><div class="bar"><span style="width:${clamp(
              val
            )}%"></span></div></div>`;
          const card = document.createElement("div");
          card.className = "p-card";
          card.innerHTML = `
            <div class="p-head">
              <div class="avatar"><img src="${
                p.photo
              }" onerror="this.src='https://static.api-football.com/players/players.webp'"></div>
              <div><div style="font-weight:700">${
                p.name
              }</div><div class="small">${p.team} ‚Ä¢ ${p.role}</div></div>
              <div style="margin-left:auto;text-align:right"><div style="font-size:22px;font-weight:800">${
                P.TOTAL
              }</div><div class="small">POWER</div></div>
            </div>
            <div class="bars">
              ${bar("ATT", P.ATT)}${bar("CRE", P.CRE)}${bar("DEF", P.DEF)}${bar(
            "FIT",
            P.FIT
          )}${bar("CTRL", P.CTRL)}
            </div>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="ghost">+ ‡∏ó‡∏µ‡∏° A</button>
              <button class="ghost">+ ‡∏ó‡∏µ‡∏° B</button>
            </div>`;
          const btns = card.querySelectorAll("button");
          btns[0].onclick = () => quickAdd("A", p);
          btns[1].onclick = () => quickAdd("B", p);
          grid.appendChild(card);
        });

        box.appendChild(sec);
        document.getElementById(
          "progress"
        ).textContent = `‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á ${teamName}`;
      }

      const isRoleMatch = (expect, role) =>
        (expect === "Goalkeeper" && role === "Goalkeeper") ||
        (expect === "Defender" && role === "Defender") ||
        (expect === "Midfielder" && role === "Midfielder") ||
        (expect === "Attacker" && role === "Attacker");

      function applyPenalty(player, isWrong) {
        const f = isWrong ? WRONG_POS_PENALTY : 1;
        const P = player.powers_gw || {
          ATT: 0,
          CRE: 0,
          DEF: 0,
          FIT: 0,
          CTRL: 0,
        };
        return Math.round(
          (P.ATT * f + P.CRE * f + P.DEF * f + P.FIT * f + P.CTRL * f) / 5
        );
      }

      function renderBoard(side, rootId) {
        const team = side === "A" ? state.A : state.B;
        const root = document.getElementById(rootId);
        root.innerHTML = "";
        team.forEach((slot, idx) => {
          const has = !!slot.player;
          const wrong = has && !isRoleMatch(slot.expect, slot.player.role);
          const d = document.createElement("div");
          d.className = `slot ${has ? "fill" : ""} ${wrong ? "wrong" : ""}`;

          /* üîß ‡∏ß‡∏≤‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô 4-3-3 */
          const pos = LAYOUT_433[slot.id];
          if (pos) {
            d.style.gridColumn = `${pos.c} / span ${pos.span || 2}`;
            d.style.gridRow = `${pos.r}`;
          }

          d.innerHTML = `<div class="small" style="opacity:.8">${slot.id} (${
            slot.expect
          })</div>
      ${
        has
          ? `<div style="display:flex;gap:8px;align-items:center;margin-top:6px">
                <div class="avatar" style="width:38px;height:38px"><img src="${
                  slot.player.photo
                }"></div>
                <div>
                  <div style="font-weight:700">${slot.player.name}</div>
                  <div class="small">${slot.player.role}${
              wrong ? ' ‚Ä¢ <span style="color:#fecaca">‡∏ú‡∏¥‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</span>' : ""
            }</div>
                  <div class="small">Power: ${slot.player.adjTotal}</div>
                </div>
              </div>`
          : `<div class="small" style="opacity:.7">‡∏Å‡∏î + ‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°</div>`
      }`;
          root.appendChild(d);
        });
        refreshSums();
        document.getElementById(
          side === "A" ? "btnConfirmA" : "btnConfirmB"
        ).disabled = !team.every((x) => !!x.player);
        document.getElementById("btnBattle").disabled = !(
          state.confirmed.A && state.confirmed.B
        );
      }

      function place(side, idx, player) {
        if (state.confirmed[side]) {
          showStatus(`‡∏ó‡∏µ‡∏° ${side} ‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß`);
          return;
        }
        const duplicated = [...state.A, ...state.B].some(
          (s) => s.player && s.player.id === player.id
        );
        if (duplicated) {
          showStatus("‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß");
          return;
        }

        const team = side === "A" ? state.A : state.B;
        if (team[idx].player) {
          showStatus("‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏•‡πâ‡∏ß");
          return;
        }

        const wrong = !isRoleMatch(team[idx].expect, player.role);
        const adj = applyPenalty(player, wrong);
        team[idx].player = { ...player, adjTotal: adj, wrong };
        renderBoard("A", "formA");
        renderBoard("B", "formB");
      }

      function quickAdd(side, player) {
        if (state.confirmed[side]) {
          showStatus(`‡∏ó‡∏µ‡∏° ${side} ‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß`);
          return;
        }
        const duplicated = [...state.A, ...state.B].some(
          (s) => s.player && s.player.id === player.id
        );
        if (duplicated) {
          showStatus("‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß");
          return;
        }

        const team = side === "A" ? state.A : state.B;
        let idx = team.findIndex(
          (s) => !s.player && isRoleMatch(s.expect, player.role)
        );
        if (idx < 0) idx = team.findIndex((s) => !s.player);
        if (idx < 0) {
          showStatus(`‡∏ó‡∏µ‡∏° ${side} ‡∏Ñ‡∏£‡∏ö 11 ‡πÅ‡∏•‡πâ‡∏ß`);
          return;
        }
        place(side, idx, player);
      }

      function refreshSums() {
        const sumA = state.A.reduce(
          (s, x) => s + (x.player ? x.player.adjTotal : 0),
          0
        );
        const sumB = state.B.reduce(
          (s, x) => s + (x.player ? x.player.adjTotal : 0),
          0
        );
        const elA = document.getElementById("sumA");
        const elB = document.getElementById("sumB");
        const unlocked = state.confirmed.A && state.confirmed.B;
        elA.textContent = unlocked ? sumA : "‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà";
        elB.textContent = unlocked ? sumB : "‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà";
        elA.classList.toggle("mask", !unlocked);
        elB.classList.toggle("mask", !unlocked);
      }

      function confirmTeam(side) {
        const team = side === "A" ? state.A : state.B;
        if (!team.every((x) => !!x.player)) {
          showStatus(`‡∏ó‡∏µ‡∏° ${side} ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö 11`);
          return;
        }
        state.confirmed[side] = true;
        showStatus(`‡∏•‡πá‡∏≠‡∏Å‡∏ó‡∏µ‡∏° ${side} ‡πÅ‡∏•‡πâ‡∏ß`);
        renderBoard("A", "formA");
        renderBoard("B", "formB");
      }

      function resetBoards() {
        if (state.confirmed.A || state.confirmed.B) {
          if (!confirm("‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏ó‡∏µ‡∏°?")) return;
        }
        state.A = FORMATION.map((x) => ({ ...x, player: null }));
        state.B = FORMATION.map((x) => ({ ...x, player: null }));
        state.confirmed = { A: false, B: false };
        state.dataSwitchQuota = { A: DATA_SWITCH_LIMIT, B: DATA_SWITCH_LIMIT };
        state.dataTeamOf = { A: null, B: null };
        document.getElementById("quotaA").textContent = state.dataSwitchQuota.A;
        document.getElementById("quotaB").textContent = state.dataSwitchQuota.B;
        renderBoard("A", "formA");
        renderBoard("B", "formB");
        refreshSums();
        document.getElementById("btnBattle").disabled = true;
        document.getElementById("result").textContent = ""; // ‡∏•‡πâ‡∏≤‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏Å‡πà‡∏≤
      }

      function battle() {
        const cntA = state.A.filter((s) => s.player).length,
          cntB = state.B.filter((s) => s.player).length;
        if (cntA < 11 || cntB < 11) {
          alert("‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö 11 ‡∏Ñ‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ó‡∏µ‡∏°");
          return;
        }
        if (!(state.confirmed.A && state.confirmed.B)) {
          alert("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ó‡∏µ‡∏°‡∏Å‡πà‡∏≠‡∏ô");
          return;
        }

        const totalA = state.A.reduce((s, x) => s + x.player.adjTotal, 0);
        const totalB = state.B.reduce((s, x) => s + x.player.adjTotal, 0);
        document.getElementById("result").textContent =
          totalA > totalB
            ? `‡∏ó‡∏µ‡∏° A ‡∏ä‡∏ô‡∏∞ ${totalA} ‡∏ï‡πà‡∏≠ ${totalB}`
            : totalB > totalA
            ? `‡∏ó‡∏µ‡∏° B ‡∏ä‡∏ô‡∏∞ ${totalB} ‡∏ï‡πà‡∏≠ ${totalA}`
            : `‡πÄ‡∏™‡∏°‡∏≠ ${totalA} ‡∏ï‡πà‡∏≠ ${totalB}`;
        openSummary(totalA, totalB);
      }
      /* ‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ (‡∏ã‡πâ‡∏≤‡∏¢: logoGrid ‡∏ó‡∏±‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î, ‡∏Å‡∏•‡∏≤‡∏á: dataLogos ‡πÉ‡∏ô sticky-head) */
      function setPickersVisible(show) {
        const lg = document.getElementById("logoGrid");
        if (lg && lg.closest("section"))
          lg.closest("section").style.display = show ? "" : "none";
        const dl = document.getElementById("dataLogos");
        if (dl && dl.parentElement)
          dl.parentElement.style.display = show ? "" : "none"; // div.sticky-head
      }

      function openSummary(totalA, totalB) {
        setPickersVisible(false); // ‚õî ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•

        document.getElementById("sumGW").textContent = state.fpl.gw || "-";
        document.getElementById("sumTotalA").textContent = totalA;
        document.getElementById("sumTotalB").textContent = totalB;

        const rows = document.getElementById("sumRows");
        rows.innerHTML = "";
        for (let i = 0; i < FORMATION.length; i++) {
          const a = state.A[i].player,
            b = state.B[i].player;
          const av = a ? a.adjTotal : 0,
            bv = b ? b.adjTotal : 0;
          const diff = av - bv,
            abs = Math.min(100, Math.abs(diff));
          const row = document.createElement("div");
          row.className = "row2";
          row.innerHTML = `
      <div style="display:flex;gap:8px;align-items:center">
        <div class="avatar" style="width:40px;height:40px">${
          a ? `<img src="${a.photo}">` : ""
        }</div>
        <div>
          <div style="font-weight:700">${a ? a.name : "‚Äî"}</div>
          <div class="small">${FORMATION[i].id} (${FORMATION[i].expect}) ‚Ä¢ ${
            a ? a.role : "-"
          }</div>
          <div class="small">Power: ${av}</div>
        </div>
      </div>
      <div>
        <div class="small" style="text-align:center;margin-bottom:4px">‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô ${
          diff > 0 ? `+${diff}` : diff
        } ‡πÅ‡∏ï‡πâ‡∏°</div>
        <div class="diffbar">${
          diff >= 0
            ? `<div class="diffA" style="width:${abs}%"></div>`
            : `<div class="diffB" style="width:${abs}%"></div>`
        }
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center;justify-content:flex-end">
        <div>
          <div style="font-weight:700;text-align:right">${
            b ? b.name : "‚Äî"
          }</div>
          <div class="small" style="text-align:right">${FORMATION[i].id} (${
            FORMATION[i].expect
          }) ‚Ä¢ ${b ? b.role : "-"}</div>
          <div class="small" style="text-align:right">Power: ${bv}</div>
        </div>
        <div class="avatar" style="width:40px;height:40px">${
          b ? `<img src="${b.photo}">` : ""
        }</div>
      </div>`;
          rows.appendChild(row);
        }
        document.getElementById("summaryView").style.display = "flex";
      }

      const closeSummary = () => {
        document.getElementById("summaryView").style.display = "none";
        setPickersVisible(true); // ‚úÖ ‡πÇ‡∏ä‡∏ß‡πå‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
      };

      // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•
      function startNewGame() {
        closeSummary(); // ‡∏õ‡∏¥‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• + ‡πÇ‡∏ä‡∏ß‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
        state.confirmed = { A: false, B: false };
        resetBoards();
      }

      document.getElementById("btnReload").onclick = loadSnapshot;

      (function init() {
        renderBoard("A", "formA");
        renderBoard("B", "formB");
        setActiveDataSide("A");
        setCrestSide("A");
        loadSnapshot();
      })();
    </script>
  </body>
</html>
